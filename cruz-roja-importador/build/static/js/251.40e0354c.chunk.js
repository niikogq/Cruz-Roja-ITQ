"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[251],{6251:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ve});var o=a(9379),n=a(5043),r=a(8163),i=a(9961),s=a(6058),l=a(3969),c=a(172),d=a(2097),u=a(5895),p=a(45),m=a(8387),h=a(2573),f=a(6061),g=a(1807),v=a(883),x=a(8480),b=a(4265);var w=a(5227),A=a(9049);const y=(e,t,a)=>{const o=e.keys[0];if(Array.isArray(t))t.forEach((t,o)=>{a((t,a)=>{o<=e.keys.length-1&&(0===o?Object.assign(t,a):t[e.up(e.keys[o])]=a)},t)});else if(t&&"object"===typeof t){(Object.keys(t).length>e.keys.length?e.keys:(n=e.keys,r=Object.keys(t),n.filter(e=>r.includes(e)))).forEach(n=>{if(e.keys.includes(n)){const r=t[n];void 0!==r&&a((t,a)=>{o===n?Object.assign(t,a):t[e.up(n)]=a},r)}})}else"number"!==typeof t&&"string"!==typeof t||a((e,t)=>{Object.assign(e,t)},t);var n,r};function C(e){return"--Grid-".concat(e,"Spacing")}function j(e){return"--Grid-parent-".concat(e,"Spacing")}const S="--Grid-columns",k="--Grid-parent-columns",E=e=>{let{theme:t,ownerState:a}=e;const o={};return y(t.breakpoints,a.size,(e,t)=>{let a={};"grow"===t&&(a={flexBasis:0,flexGrow:1,maxWidth:"100%"}),"auto"===t&&(a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),"number"===typeof t&&(a={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(t," / var(").concat(k,") - (var(").concat(k,") - ").concat(t,") * (var(").concat(j("column"),") / var(").concat(k,")))")}),e(o,a)}),o},N=e=>{let{theme:t,ownerState:a}=e;const o={};return y(t.breakpoints,a.offset,(e,t)=>{let a={};"auto"===t&&(a={marginLeft:"auto"}),"number"===typeof t&&(a={marginLeft:0===t?"0px":"calc(100% * ".concat(t," / var(").concat(k,") + var(").concat(j("column"),") * ").concat(t," / var(").concat(k,"))")}),e(o,a)}),o},M=e=>{let{theme:t,ownerState:a}=e;if(!a.container)return{};const o={[S]:12};return y(t.breakpoints,a.columns,(e,t)=>{const a=null!==t&&void 0!==t?t:12;e(o,{[S]:a,"> *":{[k]:a}})}),o},z=e=>{let{theme:t,ownerState:a}=e;if(!a.container)return{};const o={};return y(t.breakpoints,a.rowSpacing,(e,a)=>{var n;const r="string"===typeof a?a:null===(n=t.spacing)||void 0===n?void 0:n.call(t,a);e(o,{[C("row")]:r,"> *":{[j("row")]:r}})}),o},G=e=>{let{theme:t,ownerState:a}=e;if(!a.container)return{};const o={};return y(t.breakpoints,a.columnSpacing,(e,a)=>{var n;const r="string"===typeof a?a:null===(n=t.spacing)||void 0===n?void 0:n.call(t,a);e(o,{[C("column")]:r,"> *":{[j("column")]:r}})}),o},R=e=>{let{theme:t,ownerState:a}=e;if(!a.container)return{};const o={};return y(t.breakpoints,a.direction,(e,t)=>{e(o,{flexDirection:t})}),o},T=e=>{let{ownerState:t}=e;return(0,o.A)({minWidth:0,boxSizing:"border-box"},t.container&&(0,o.A)((0,o.A)({display:"flex",flexWrap:"wrap"},t.wrap&&"wrap"!==t.wrap&&{flexWrap:t.wrap}),{},{gap:"var(".concat(C("row"),") var(").concat(C("column"),")")}))},W=e=>{const t=[];return Object.entries(e).forEach(e=>{let[a,o]=e;!1!==o&&void 0!==o&&t.push("grid-".concat(a,"-").concat(String(o)))}),t},O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"xs";function a(e){return void 0!==e&&("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e&&e>0)}if(a(e))return["spacing-".concat(t,"-").concat(String(e))];if("object"===typeof e&&!Array.isArray(e)){const t=[];return Object.entries(e).forEach(e=>{let[o,n]=e;a(n)&&t.push("spacing-".concat(o,"-").concat(String(n)))}),t}return[]},L=e=>void 0===e?[]:"object"===typeof e?Object.entries(e).map(e=>{let[t,a]=e;return"direction-".concat(t,"-").concat(a)}):["direction-xs-".concat(String(e))];var P=a(579);const D=["className","children","columns","container","component","direction","wrap","size","offset","spacing","rowSpacing","columnSpacing","unstable_level"],I=(0,A.A)(),U=(0,v.A)("div",{name:"MuiGrid",slot:"Root"});function F(e){return function(e){let{props:t,name:a,defaultTheme:o,themeId:n}=e,r=(0,b.A)(o);return n&&(r=r[n]||r),(0,x.A)({theme:r,name:a,props:t})}({props:e,name:"MuiGrid",defaultTheme:I})}var _=a(8128),B=a(9192),H=a(267);const V=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=U,useThemeProps:a=F,useTheme:r=b.A,componentName:i="MuiGrid"}=e;function s(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;const o={};return null===e||(Array.isArray(e)?e.forEach((e,n)=>{null!==e&&a(e)&&t.keys[n]&&(o[t.keys[n]]=e)}):"object"===typeof e?Object.keys(e).forEach(t=>{const n=e[t];null!==n&&void 0!==n&&a(n)&&(o[t]=n)}):o[t.keys[0]]=e),o}const l=t(M,G,z,E,R,T,N),c=n.forwardRef(function(e,t){var c,d,u,v,x,b;const A=r(),y=a(e),C=(0,w.A)(y);!function(e,t){const a=[];void 0!==e.item&&(delete e.item,a.push("item")),void 0!==e.zeroMinWidth&&(delete e.zeroMinWidth,a.push("zeroMinWidth")),t.keys.forEach(t=>{void 0!==e[t]&&(a.push(t),delete e[t])})}(C,A.breakpoints);const{className:j,children:S,columns:k=12,container:E=!1,component:N="div",direction:M="row",wrap:z="wrap",size:G={},offset:R={},spacing:T=0,rowSpacing:I=T,columnSpacing:U=T,unstable_level:F=0}=C,_=(0,p.A)(C,D),B=s(G,A.breakpoints,e=>!1!==e),H=s(R,A.breakpoints),V=null!==(c=e.columns)&&void 0!==c?c:F?void 0:k,J=null!==(d=e.spacing)&&void 0!==d?d:F?void 0:T,Z=null!==(u=null!==(v=e.rowSpacing)&&void 0!==v?v:e.spacing)&&void 0!==u?u:F?void 0:I,$=null!==(x=null!==(b=e.columnSpacing)&&void 0!==b?b:e.spacing)&&void 0!==x?x:F?void 0:U,q=(0,o.A)((0,o.A)({},C),{},{level:F,columns:V,container:E,direction:M,wrap:z,spacing:J,rowSpacing:Z,columnSpacing:$,size:B,offset:H}),K=((e,t)=>{const{container:a,direction:o,spacing:n,wrap:r,size:s}=e,l={root:["root",a&&"container","wrap"!==r&&"wrap-xs-".concat(String(r)),...L(o),...W(s),...a?O(n,t.breakpoints.keys[0]):[]]};return(0,g.A)(l,e=>(0,f.Ay)(i,e),{})})(q,A);return(0,P.jsx)(l,(0,o.A)((0,o.A)({ref:t,as:N,ownerState:q,className:(0,m.A)(K.root,j)},_),{},{children:n.Children.map(S,e=>{var t,a;return n.isValidElement(e)&&(0,h.A)(e,["Grid"])&&E&&e.props.container?n.cloneElement(e,{unstable_level:null!==(t=null===(a=e.props)||void 0===a?void 0:a.unstable_level)&&void 0!==t?t:F+1}):e})}))});return c.muiName="Grid",c}({createStyledComponent:(0,_.Ay)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.container&&t.container]}}),componentName:"MuiGrid",useThemeProps:e=>(0,B.b)({props:e,name:"MuiGrid"}),useTheme:H.A});const J=V;const Z=(0,a(9992).A)((0,P.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),$="http://localhost:3001/api",q={voluntarios:"".concat($,"/voluntarios"),filiales:"".concat($,"/filiales"),filialesTotals:"".concat($,"/filialesTotals")};console.log("URL de voluntarios:",q.voluntarios);const K={getAll:async()=>{const e=await fetch(q.voluntarios);if(!e.ok)throw new Error("Error al cargar voluntarios");return e.json()},updateCalidad:async(e,t)=>{const a=await fetch("".concat(q.voluntarios,"/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({"Calidad de voluntario":t})});if(!a.ok)throw new Error("Error al actualizar calidad");return a.json()},updateGenero:async(e,t)=>{const a=await fetch("".concat(q.voluntarios,"/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({"G\xe9nero":t})});if(!a.ok)throw new Error("Error al actualizar g\xe9nero");return a.json()}};var Q=a(7203),X=a(7471);const Y=n.memo(e=>{let{value:t,options:a,isUpdating:o,onChange:n}=e;return o?(0,P.jsx)(c.A,{size:20}):(0,P.jsx)(Q.A,{value:t||"",onChange:n,size:"small",sx:{minWidth:110},children:a.map(e=>(0,P.jsx)(X.A,{value:e,children:e},e))})});Y.displayName="EditableSelect";var ee=a(4799),te=a(9857);function ae(e){return(0,f.Ay)("MuiCard",e)}(0,te.A)("MuiCard",["root"]);const oe=["className","raised"],ne=(0,_.Ay)(ee.A,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),re=n.forwardRef(function(e,t){const a=(0,B.b)({props:e,name:"MuiCard"}),{className:n,raised:r=!1}=a,i=(0,p.A)(a,oe),s=(0,o.A)((0,o.A)({},a),{},{raised:r}),l=(e=>{const{classes:t}=e;return(0,g.A)({root:["root"]},ae,t)})(s);return(0,P.jsx)(ne,(0,o.A)({className:(0,m.A)(l.root,n),elevation:r?8:void 0,ref:t,ownerState:s},i))});function ie(e){return(0,f.Ay)("MuiCardContent",e)}(0,te.A)("MuiCardContent",["root"]);const se=["className","component"],le=(0,_.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),ce=n.forwardRef(function(e,t){const a=(0,B.b)({props:e,name:"MuiCardContent"}),{className:n,component:r="div"}=a,i=(0,p.A)(a,se),s=(0,o.A)((0,o.A)({},a),{},{component:r}),l=(e=>{const{classes:t}=e;return(0,g.A)({root:["root"]},ie,t)})(s);return(0,P.jsx)(le,(0,o.A)({as:r,className:(0,m.A)(l.root,n),ownerState:s,ref:t},i))}),de=n.memo(e=>{let{title:t,value:a,gradient:o,shadowColor:n}=e;return(0,P.jsx)(re,{sx:{background:o,color:"#fff",boxShadow:"0 4px 12px ".concat(n)},children:(0,P.jsxs)(ce,{children:[(0,P.jsx)(u.A,{variant:"h3",fontWeight:"bold",children:a}),(0,P.jsx)(u.A,{variant:"body1",sx:{mt:1},children:t})]})})});function ue(e){if(!e)return"";const t=function(e){const t=Math.floor(e-25569),a=new Date(86400*(t+1)*1e3),o=e-Math.floor(e)+1e-7;let n=Math.floor(86400*o),r=n%60;n-=r;let i=Math.floor(n/3600),s=Math.floor(n/60)%60;return a.setHours(i),a.setMinutes(s),a.setSeconds(r),a}(e);return t.toLocaleDateString("es-CL")}de.displayName="StatsCard";const pe=["Activo","Llamada"],me=["F","M","Otro"],he={primary:"#9c1821",primaryDark:"#7a1419",active:"#38b000",llamada:"#f8c102",info:"#1976d2",white:"#fff"},fe={activos:"#38b000",llamada:"#f8c102",primary:"#9c1821"};var ge=a(7304);function ve(){const{nombre:e}=(0,r.g)(),t=(0,r.Zp)(),[a,p]=(0,n.useState)([]),[m,h]=(0,n.useState)(!0),[f,g]=(0,n.useState)(null),[v,x]=(0,n.useState)(null),b=(0,n.useMemo)(()=>{const e=a.filter(e=>"Activo"===e["Calidad de voluntario"]).length,t=a.filter(e=>"Llamada"===e["Calidad de voluntario"]).length,o=a.filter(e=>e.Edad).map(e=>e.Edad),n=o.length>0?Math.round(o.reduce((e,t)=>e+t,0)/o.length):0,r={};a.forEach(e=>{const t=e.Cargo||"Sin cargo";r[t]=(r[t]||0)+1});const i=Object.entries(r).map(e=>{let[t,a]=e;return{name:t,value:a}}).sort((e,t)=>t.value-e.value).slice(0,5);return{total:a.length,activos:e,llamada:t,promedioEdad:n,distribucionCargo:i}},[a]);(0,n.useEffect)(()=>{(async()=>{try{const t=(await K.getAll()).filter(t=>t.Filial===decodeURIComponent(e));p(t.map((e,t)=>(0,o.A)({id:t+1},e)))}catch(t){console.error("Error cargando voluntarios:",t)}finally{h(!1)}})()},[e]);const w=(0,n.useCallback)(async(e,t)=>{g(e);const n=a.find(t=>t.id===e);try{await K.updateCalidad(n._id,t),p(a=>a.map(a=>a.id===e?(0,o.A)((0,o.A)({},a),{},{"Calidad de voluntario":t}):a)),window.dispatchEvent(new Event("refreshFiliales"))}catch(r){alert("Error al actualizar!")}finally{g(null)}},[a]),A=(0,n.useCallback)(async(e,t)=>{x(e);const n=a.find(t=>t.id===e);try{await K.updateGenero(n._id,t),p(a=>a.map(a=>a.id===e?(0,o.A)((0,o.A)({},a),{},{"G\xe9nero":t}):a)),window.dispatchEvent(new Event("refreshFiliales"))}catch(r){alert("Error al actualizar g\xe9nero!")}finally{x(null)}},[a]),y=(0,n.useMemo)(()=>[{field:"id",headerName:"ID",width:60},{field:"Nombres voluntario",headerName:"Nombre",width:150},{field:"Apellidos voluntarios",headerName:"Apellido",width:150},{field:"RUT",headerName:"RUT",width:120},{field:"Cargo",headerName:"Cargo",width:140},{field:"Calidad de voluntario",headerName:"Calidad",width:130,renderCell:e=>(0,P.jsx)(Y,{value:e.value,options:pe,isUpdating:f===e.id,onChange:t=>w(e.id,t.target.value)})},{field:"Edad",headerName:"Edad",width:80},{field:"G\xe9nero",headerName:"G\xe9nero",width:100,renderCell:e=>(0,P.jsx)(Y,{value:e.value,options:me,isUpdating:v===e.id,onChange:t=>A(e.id,t.target.value)})},{field:"fecha de ingreso",headerName:"Fecha Ingreso",width:130,renderCell:e=>ue(e.value)},{field:"Correo ",headerName:"Correo",width:180},{field:"Telefono",headerName:"Tel\xe9fono",width:120}],[f,v,w,A]),C=(0,n.useMemo)(()=>({labels:["Activos","De Llamada"],datasets:[{data:[b.activos,b.llamada],backgroundColor:[fe.activos,fe.llamada],borderWidth:3,borderColor:he.white}]}),[b]),j=(0,n.useMemo)(()=>{var e,t;return{labels:(null===(e=b.distribucionCargo)||void 0===e?void 0:e.map(e=>e.name))||[],datasets:[{label:"Cantidad de Voluntarios",data:(null===(t=b.distribucionCargo)||void 0===t?void 0:t.map(e=>e.value))||[],backgroundColor:he.primary}]}},[b]);return m?(0,P.jsx)(l.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,P.jsx)(c.A,{style:{color:he.primary}})}):(0,P.jsxs)(l.A,{sx:{maxWidth:1400,margin:1,marginTop:-4},children:[(0,P.jsx)(d.A,{startIcon:(0,P.jsx)(Z,{}),onClick:()=>t("/filiales"),sx:{mb:1,color:he.primary,fontWeight:600,"&:hover":{backgroundColor:"rgba(156, 24, 33, 0.04)"}},children:"Volver a Filiales"}),(0,P.jsxs)(u.A,{variant:"h4",sx:{mb:4,color:he.primary,fontWeight:700},children:["Filial: ",decodeURIComponent(e)]}),(0,P.jsxs)(J,{container:!0,spacing:3,sx:{mb:4},children:[(0,P.jsx)(J,{size:{sx:12,sm:6,md:3},children:(0,P.jsx)(de,{title:"Total Voluntarios",value:b.total,gradient:"linear-gradient(135deg, #9c1821 0%, #c54646 100%)",shadowColor:"rgba(156, 24, 33, 0.3)"})}),(0,P.jsx)(J,{size:{sx:12,sm:6,md:3},children:(0,P.jsx)(de,{title:"Voluntarios Activos",value:b.activos,gradient:"linear-gradient(135deg, #38b000 0%, #4caf50 100%)",shadowColor:"rgba(56, 176, 0, 0.3)"})}),(0,P.jsx)(J,{size:{sx:12,sm:6,md:3},children:(0,P.jsx)(de,{title:"De Llamada",value:b.llamada,gradient:"linear-gradient(135deg, #f8c102 0%, #ffc107 100%)",shadowColor:"rgba(248, 193, 2, 0.3)"})}),(0,P.jsx)(J,{size:{sx:12,sm:6,md:3},children:(0,P.jsx)(de,{title:"Edad Promedio",value:b.promedioEdad,gradient:"linear-gradient(135deg, #1976d2 0%, #42a5f5 100%)",shadowColor:"rgba(25, 118, 210, 0.3)"})})]}),(0,P.jsxs)(J,{container:!0,spacing:3,sx:{mb:4},children:[(0,P.jsx)(J,{size:{sx:12,sm:6},children:(0,P.jsxs)(l.A,{sx:{background:"#fff",p:3,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[(0,P.jsx)(u.A,{variant:"h6",sx:{mb:2,color:he.primary,fontWeight:600},children:"Distribuci\xf3n: Activos vs Llamada"}),(0,P.jsx)(l.A,{sx:{height:280,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,P.jsx)(s.nu,{data:C,options:{maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})]})}),(0,P.jsx)(J,{size:{sx:12,sm:6},children:(0,P.jsxs)(l.A,{sx:{background:"#fff",p:3,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[(0,P.jsx)(u.A,{variant:"h6",sx:{mb:2,color:he.primary,fontWeight:600},children:"Cantidad voluntarios por cargo"}),(0,P.jsx)(l.A,{sx:{height:280},children:(0,P.jsx)(s.yP,{data:j,options:{maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})})]})})]}),(0,P.jsx)(u.A,{variant:"h5",sx:{mb:2,color:he.primary,fontWeight:600},children:"Lista Completa de Voluntarios"}),(0,P.jsx)(l.A,{sx:{height:500,background:"#fff",borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",width:1e3},children:(0,P.jsx)(i.z,{rows:a,columns:y,pageSize:10,rowsPerPageOptions:[10,25,50],disableSelectionOnClick:!0})})]})}ge.t1.register(ge.Bs,ge.PP,ge.kc,ge.E8,ge.m_,ge.s$)}}]);
//# sourceMappingURL=251.40e0354c.chunk.js.map