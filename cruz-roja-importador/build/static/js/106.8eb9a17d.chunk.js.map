{"version":3,"file":"static/js/106.8eb9a17d.chunk.js","mappings":"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","sources":["pages/Sugerencias.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { DataGrid } from '@mui/x-data-grid';\r\nimport Button from '@mui/material/Button';\r\nimport PictureAsPdfIcon from '@mui/icons-material/PictureAsPdf';\r\nimport Box from '@mui/material/Box';\r\nimport { jsPDF } from 'jspdf';\r\n\r\n\r\nconst columns = [\r\n  { field: 'Filial', headerName: 'Filial', width: 200 },\r\n  { \r\n    field: 'Comentarios',\r\n    headerName: 'Comentarios', \r\n    width: 800, \r\n    flex: 1,\r\n    editable: true,\r\n    renderCell: (params) => (\r\n      <div style={{ whiteSpace: 'normal', wordWrap: 'break-word', lineHeight: '1.5' }}>\r\n        {params.value || ''}\r\n      </div>\r\n    )\r\n  },\r\n];\r\n\r\nexport default function Sugerencias() {\r\n  const [rows, setRows] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetch('http://localhost:3001/api/filiales')\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        setRows(data.map((v, idx) => ({ \r\n          id: v._id.toString(),\r\n          _id: v._id,\r\n          ...v,\r\n          Comentarios: v.Comentarios || ''\r\n        })));\r\n        setLoading(false);\r\n      })\r\n      .catch(error => {\r\n        console.error('Error al cargar filiales:', error);\r\n        setLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  const processRowUpdate = async (newRow) => {\r\n    console.log('Guardando comentario para ID:', newRow.id);\r\n    \r\n    const response = await fetch(`http://localhost:3001/api/filiales/${newRow.id}`, {\r\n      method: 'PATCH',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ Comentarios: newRow.Comentarios })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      console.error('Error del servidor:', errorData);\r\n      throw new Error('Error al actualizar comentario');\r\n    }\r\n\r\n    console.log('✅ Comentario guardado exitosamente');\r\n    return newRow;\r\n  };\r\n\r\n  const handleProcessRowUpdateError = (error) => {\r\n    console.error('Error al actualizar:', error);\r\n    alert('Error al guardar el comentario. Revisa la consola para más detalles.');\r\n  };\r\n\r\n  const generarPDF = () => {\r\n    const doc = new jsPDF();\r\n    \r\n    // Fecha actual\r\n    const fecha = new Date();\r\n    const fechaFormateada = fecha.toLocaleDateString('es-CL', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric'\r\n    });\r\n    const horaFormateada = fecha.toLocaleTimeString('es-CL', {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n\r\n    // Encabezado\r\n    doc.setFontSize(18);\r\n    doc.setTextColor(156, 24, 33);\r\n    doc.text('Cruz Roja Chilena', 105, 15, { align: 'center' });\r\n    \r\n    doc.setFontSize(14);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text('Informe de Sugerencias por Filial', 105, 25, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(`Fecha de generación: ${fechaFormateada} - ${horaFormateada}`, 105, 32, { align: 'center' });\r\n\r\n    // Filtrar filiales con comentarios\r\n    const filialesConComentarios = rows.filter(row => row.Comentarios && row.Comentarios.trim() !== '');\r\n\r\n    if (filialesConComentarios.length === 0) {\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.setFontSize(12);\r\n      doc.text('No hay comentarios registrados.', 105, 50, { align: 'center' });\r\n    } else {\r\n      // Configuración de la tabla\r\n      const startY = 45;\r\n      const rowHeight = 10;\r\n      const colFilialWidth = 40;\r\n      const colComentarioWidth = 140;\r\n      const startX = 15;\r\n      let currentY = startY;\r\n\r\n      // Dibujar encabezado de la tabla\r\n      doc.setFillColor(156, 24, 33); // Color rojo Cruz Roja\r\n      doc.rect(startX, currentY, colFilialWidth, rowHeight, 'F');\r\n      doc.rect(startX + colFilialWidth, currentY, colComentarioWidth, rowHeight, 'F');\r\n      \r\n      doc.setTextColor(255, 255, 255);\r\n      doc.setFont('helvetica', 'bold');\r\n      doc.setFontSize(11);\r\n      doc.text('Filial', startX + 2, currentY + 7);\r\n      doc.text('Comentarios', startX + colFilialWidth + 2, currentY + 7);\r\n      \r\n      currentY += rowHeight;\r\n\r\n      // Dibujar filas de datos\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.setFont('helvetica', 'normal');\r\n      doc.setFontSize(9);\r\n\r\n      filialesConComentarios.forEach((row, index) => {\r\n        const filial = row.Filial || 'Sin nombre';\r\n        const comentario = row.Comentarios || 'Sin comentario';\r\n        \r\n        // Dividir comentario en múltiples líneas si es muy largo\r\n        const comentarioLineas = doc.splitTextToSize(comentario, colComentarioWidth - 4);\r\n        const cellHeight = Math.max(rowHeight, comentarioLineas.length * 5 + 4);\r\n\r\n        // Verificar si necesita nueva página\r\n        if (currentY + cellHeight > 280) {\r\n          doc.addPage();\r\n          currentY = 20;\r\n          \r\n          // Redibujar encabezado en nueva página\r\n          doc.setFillColor(156, 24, 33);\r\n          doc.rect(startX, currentY, colFilialWidth, rowHeight, 'F');\r\n          doc.rect(startX + colFilialWidth, currentY, colComentarioWidth, rowHeight, 'F');\r\n          \r\n          doc.setTextColor(255, 255, 255);\r\n          doc.setFont('helvetica', 'bold');\r\n          doc.setFontSize(11);\r\n          doc.text('Filial', startX + 2, currentY + 7);\r\n          doc.text('Comentarios', startX + colFilialWidth + 2, currentY + 7);\r\n          \r\n          currentY += rowHeight;\r\n          doc.setTextColor(0, 0, 0);\r\n          doc.setFont('helvetica', 'normal');\r\n          doc.setFontSize(9);\r\n        }\r\n\r\n        // Color de fondo alternado para filas\r\n        if (index % 2 === 0) {\r\n          doc.setFillColor(245, 245, 245);\r\n          doc.rect(startX, currentY, colFilialWidth + colComentarioWidth, cellHeight, 'F');\r\n        }\r\n\r\n        // Dibujar bordes de celda\r\n        doc.setDrawColor(200, 200, 200);\r\n        doc.rect(startX, currentY, colFilialWidth, cellHeight);\r\n        doc.rect(startX + colFilialWidth, currentY, colComentarioWidth, cellHeight);\r\n\r\n        // Texto de filial\r\n        doc.setFont('helvetica', 'bold');\r\n        const filialLineas = doc.splitTextToSize(filial, colFilialWidth - 4);\r\n        doc.text(filialLineas, startX + 2, currentY + 5);\r\n\r\n        // Texto de comentario\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.text(comentarioLineas, startX + colFilialWidth + 2, currentY + 5);\r\n\r\n        currentY += cellHeight;\r\n      });\r\n\r\n      // Pie de página con número de páginas\r\n      const pageCount = doc.internal.getNumberOfPages();\r\n      for (let i = 1; i <= pageCount; i++) {\r\n        doc.setPage(i);\r\n        doc.setFontSize(8);\r\n        doc.setTextColor(150, 150, 150);\r\n        doc.text(\r\n          `Página ${i} de ${pageCount}`,\r\n          doc.internal.pageSize.getWidth() / 2,\r\n          doc.internal.pageSize.getHeight() - 10,\r\n          { align: 'center' }\r\n        );\r\n      }\r\n    }\r\n\r\n    doc.save(`Informe_Sugerencias_${fechaFormateada.replace(/\\//g, '-')}.pdf`);\r\n  };\r\n\r\n  return (\r\n    <div style={{ width: '90%', margin: 'auto', background: '#f8f9fa', padding: 2 }}>\r\n      <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={0} mt={0}>\r\n        <h2 style={{ marginBottom: 10, color: '#9c1821' }}>Sugerencias por Filial</h2>\r\n        <Button\r\n          variant=\"contained\"\r\n          startIcon={<PictureAsPdfIcon />}\r\n          onClick={generarPDF}\r\n          sx={{ \r\n            bgcolor: '#9c1821',\r\n            '&:hover': { bgcolor: '#7a1419' }\r\n          }}\r\n        >\r\n          Generar Informe PDF\r\n        </Button>\r\n      </Box>\r\n      <div style={{ height: 400, overflowY: 'auto' }}>\r\n        <DataGrid\r\n          rows={rows}\r\n          columns={columns}\r\n          pageSize={12}\r\n          loading={loading}\r\n          disableSelectionOnClick\r\n          processRowUpdate={processRowUpdate}\r\n          onProcessRowUpdateError={handleProcessRowUpdateError}\r\n          experimentalFeatures={{ newEditingApi: true }}\r\n          sx={{\r\n            background: '##f8f9fa',\r\n            '& .MuiDataGrid-columnHeaders': {\r\n              backgroundColor: '#c54646',\r\n              color: '#000000ff',\r\n              fontWeight: 'bold',\r\n            },\r\n          }}\r\n          style={{ height: '100%' }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["columns","field","headerName","width","flex","editable","renderCell","params","_jsx","style","whiteSpace","wordWrap","lineHeight","children","value","Sugerencias","rows","setRows","useState","loading","setLoading","useEffect","fetch","then","res","json","data","map","v","idx","_objectSpread","id","_id","toString","Comentarios","catch","error","console","_jsxs","margin","background","padding","Box","display","justifyContent","alignItems","mb","mt","marginBottom","color","Button","variant","startIcon","PictureAsPdfIcon","onClick","generarPDF","doc","jsPDF","fecha","Date","fechaFormateada","toLocaleDateString","day","month","year","horaFormateada","toLocaleTimeString","hour","minute","setFontSize","setTextColor","text","align","concat","filialesConComentarios","filter","row","trim","length","rowHeight","colFilialWidth","colComentarioWidth","startX","currentY","setFillColor","rect","setFont","forEach","index","filial","Filial","comentario","comentarioLineas","splitTextToSize","cellHeight","Math","max","addPage","setDrawColor","filialLineas","pageCount","internal","getNumberOfPages","i","setPage","pageSize","getWidth","getHeight","save","replace","sx","bgcolor","height","overflowY","DataGrid","disableSelectionOnClick","processRowUpdate","async","log","newRow","response","method","headers","body","JSON","stringify","ok","errorData","Error","onProcessRowUpdateError","alert","experimentalFeatures","newEditingApi","backgroundColor","fontWeight"],"ignoreList":[],"sourceRoot":""}