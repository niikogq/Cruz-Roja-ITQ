"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[106],{1106:(e,t,o)=>{o.r(t),o.d(t,{default:()=>h});var r=o(9379),a=o(5043),i=o(9961),n=o(2097),l=o(4917),s=o(3969),c=o(1389),d=o(579);const g=[{field:"Filial",headerName:"Filial",width:200},{field:"Comentarios",headerName:"Comentarios",width:800,flex:1,editable:!0,renderCell:e=>(0,d.jsx)("div",{style:{whiteSpace:"normal",wordWrap:"break-word",lineHeight:"1.5"},children:e.value||""})}];function h(){const[e,t]=(0,a.useState)([]),[o,h]=(0,a.useState)(!0);(0,a.useEffect)(()=>{fetch("http://localhost:3001/api/filiales").then(e=>e.json()).then(e=>{t(e.map((e,t)=>(0,r.A)((0,r.A)({id:e._id.toString(),_id:e._id},e),{},{Comentarios:e.Comentarios||""}))),h(!1)}).catch(e=>{console.error("Error al cargar filiales:",e),h(!1)})},[]);return(0,d.jsxs)("div",{style:{width:"90%",margin:"auto",background:"#f8f9fa",padding:2},children:[(0,d.jsxs)(s.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:0,mt:0,children:[(0,d.jsx)("h2",{style:{marginBottom:10,color:"#9c1821"},children:"Sugerencias por Filial"}),(0,d.jsx)(n.A,{variant:"contained",startIcon:(0,d.jsx)(l.A,{}),onClick:()=>{const t=new c.uE,o=new Date,r=o.toLocaleDateString("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}),a=o.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"});t.setFontSize(18),t.setTextColor(156,24,33),t.text("Cruz Roja Chilena",105,15,{align:"center"}),t.setFontSize(14),t.setTextColor(0,0,0),t.text("Informe de Sugerencias por Filial",105,25,{align:"center"}),t.setFontSize(10),t.setTextColor(100,100,100),t.text("Fecha de generaci\xf3n: ".concat(r," - ").concat(a),105,32,{align:"center"});const i=e.filter(e=>e.Comentarios&&""!==e.Comentarios.trim());if(0===i.length)t.setTextColor(0,0,0),t.setFontSize(12),t.text("No hay comentarios registrados.",105,50,{align:"center"});else{const e=10,o=40,r=140,a=15;let n=45;t.setFillColor(156,24,33),t.rect(a,n,o,e,"F"),t.rect(a+o,n,r,e,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(11),t.text("Filial",a+2,n+7),t.text("Comentarios",a+o+2,n+7),n+=e,t.setTextColor(0,0,0),t.setFont("helvetica","normal"),t.setFontSize(9),i.forEach((i,l)=>{const s=i.Filial||"Sin nombre",c=i.Comentarios||"Sin comentario",d=t.splitTextToSize(c,r-4),g=Math.max(e,5*d.length+4);n+g>280&&(t.addPage(),n=20,t.setFillColor(156,24,33),t.rect(a,n,o,e,"F"),t.rect(a+o,n,r,e,"F"),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.setFontSize(11),t.text("Filial",a+2,n+7),t.text("Comentarios",a+o+2,n+7),n+=e,t.setTextColor(0,0,0),t.setFont("helvetica","normal"),t.setFontSize(9)),l%2===0&&(t.setFillColor(245,245,245),t.rect(a,n,o+r,g,"F")),t.setDrawColor(200,200,200),t.rect(a,n,o,g),t.rect(a+o,n,r,g),t.setFont("helvetica","bold");const h=t.splitTextToSize(s,o-4);t.text(h,a+2,n+5),t.setFont("helvetica","normal"),t.text(d,a+o+2,n+5),n+=g});const l=t.internal.getNumberOfPages();for(let i=1;i<=l;i++)t.setPage(i),t.setFontSize(8),t.setTextColor(150,150,150),t.text("P\xe1gina ".concat(i," de ").concat(l),t.internal.pageSize.getWidth()/2,t.internal.pageSize.getHeight()-10,{align:"center"})}t.save("Informe_Sugerencias_".concat(r.replace(/\//g,"-"),".pdf"))},sx:{bgcolor:"#9c1821","&:hover":{bgcolor:"#7a1419"}},children:"Generar Informe PDF"})]}),(0,d.jsx)("div",{style:{height:400,overflowY:"auto"},children:(0,d.jsx)(i.z,{rows:e,columns:g,pageSize:12,loading:o,disableSelectionOnClick:!0,processRowUpdate:async e=>{console.log("Guardando comentario para ID:",e.id);const t=await fetch("http://localhost:3001/api/filiales/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({Comentarios:e.Comentarios})});if(!t.ok){const e=await t.json();throw console.error("Error del servidor:",e),new Error("Error al actualizar comentario")}return console.log("\u2705 Comentario guardado exitosamente"),e},onProcessRowUpdateError:e=>{console.error("Error al actualizar:",e),alert("Error al guardar el comentario. Revisa la consola para m\xe1s detalles.")},experimentalFeatures:{newEditingApi:!0},sx:{background:"##f8f9fa","& .MuiDataGrid-columnHeaders":{backgroundColor:"#c54646",color:"#000000ff",fontWeight:"bold"}},style:{height:"100%"}})})]})}}}]);
//# sourceMappingURL=106.8eb9a17d.chunk.js.map